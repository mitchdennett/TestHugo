<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title> - Hugo Whisper Theme</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="/favicon.png">

  
  
  <link rel="stylesheet" href="/css/style.min.aad43d4ecb69a264f2539b89d7f779d5f3cdff22e7585fe5fc3c77272f1c2696.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/">
        <span>Home</span>
      </a>
    </li>
    
    <li class="menu-item-docs">
      <a href="/docs/">
        <span>Docs</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="/"><img alt="Logo" src="/images/logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="/"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/">
        <span>Home</span>
      </a>
    </li>
    
    <li class="menu-item-docs">
      <a href="/docs/">
        <span>Docs</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            




<div class="docs-menu">
  <div class="form-input-group mb-3 pr-3">
    <label>Version</label>
    <div class="custom_select">
      <select onchange="this.options[this.selectedIndex].value && (window.location = this.options[this.selectedIndex].value);">
        
          
            <option value="/docs/">docs</option>
          
        
          
            <option value="/v1.5/" selected>v1.5</option>
          
        
          
            <option value="/headless/">headless</option>
          
        
      </select>
    </div>
  </div>
  <ul class="toc">
    <h1 id="table-of-contents">Table of contents</h1>
<ul>
<li><a href="Introduction">Introduction</a></li>
</ul>
<h2 id="prologue">Prologue</h2>
<ul>
<li><a href="Introduction%20and%20Installaton">Introduction and Installaton</a></li>
<li><a href="Contributing%20Guide">Contributing Guide</a></li>
<li><a href="How%20To%20Contribute">How To Contribute</a></li>
<li><a href="Release%20Cycle">Release Cycle</a></li>
</ul>
<h2 id="whats-new">What&rsquo;s New</h2>
<ul>
<li><a href="Masonite%201.3">Masonite 1.3</a></li>
<li><a href="Masonite%201.4">Masonite 1.4</a></li>
<li><a href="Masonite%201.5">Masonite 1.5</a></li>
</ul>
<h2 id="upgrade-guide">Upgrade Guide</h2>
<ul>
<li><a href="Masonite%201.3%20to%201.4">Masonite 1.3 to 1.4</a></li>
<li><a href="Masonite%201.4%20to%201.5">Masonite 1.4 to 1.5</a></li>
</ul>
<h2 id="the-basics">The Basics</h2>
<ul>
<li><a href="Routing">Routing</a></li>
<li><a href="Controllers">Controllers</a></li>
<li><a href="Views">Views</a></li>
<li><a href="Requests">Requests</a></li>
<li><a href="Static%20Files">Static Files</a></li>
<li><a href="Helper%20Functions">Helper Functions</a></li>
</ul>
<h2 id="the-craft-command">The Craft Command</h2>
<ul>
<li><a href="Introduction">Introduction</a></li>
<li><a href="Creating%20Commands">Creating Commands</a></li>
<li><a href="Authentication%20System">Authentication System</a></li>
</ul>
<h2 id="architectural-concepts">Architectural Concepts</h2>
<ul>
<li><a href="Request%20Lifecycle">Request Lifecycle</a></li>
<li><a href="Service%20Providers">Service Providers</a></li>
<li><a href="Service%20Container">Service Container</a></li>
</ul>
<h2 id="advanced">Advanced</h2>
<ul>
<li><a href="Middleware">Middleware</a></li>
<li><a href="Validation">Validation</a></li>
<li><a href="Creating%20Packages">Creating Packages</a></li>
<li><a href="Extending%20Classes">Extending Classes</a></li>
<li><a href="Creating%20a%20Mail%20Driver">Creating a Mail Driver</a></li>
<li><a href="Sessions">Sessions</a></li>
</ul>
<h2 id="useful-features">Useful Features</h2>
<ul>
<li><a href="Template%20Caching">Template Caching</a></li>
<li><a href="Mail">Mail</a></li>
<li><a href="Uploading">Uploading</a></li>
<li><a href="View%20Composers%20and%20Sharing">View Composers and Sharing</a></li>
<li><a href="Caching">Caching</a></li>
<li><a href="Broadcasting">Broadcasting</a></li>
<li><a href="Queues%20and%20Jobs">Queues and Jobs</a></li>
<li><a href="Compiling%20Assets">Compiling Assets</a></li>
</ul>
<h2 id="security">Security</h2>
<ul>
<li><a href="Authentication">Authentication</a></li>
<li><a href="Encryption">Encryption</a></li>
<li><a href="CSRF%20Protection">CSRF Protection</a></li>
</ul>
<h2 id="orator-orm">Orator ORM</h2>
<ul>
<li><a href="Basic%20Usage" target="_blank">Basic Usage</a></li>
<li><a href="Query%20Builder" target="_blank">Query Builder</a></li>
<li><a href="ORM" target="_blank">ORM</a></li>
<li><a href="Pagination" target="_blank">Pagination</a></li>
<li><a href="Schema%20Builder" target="_blank">Schema Builder</a></li>
<li><a href="Database%20Migrations">Database Migrations</a></li>
<li><a href="Collections" target="_blank">Collections</a></li>
</ul>
<h2 id="managers-and-drivers">Managers and Drivers</h2>
<ul>
<li><a href="About%20Managers">About Managers</a></li>
<li><a href="About%20Drivers">About Drivers</a></li>
<li><a href="Contracts">Contracts</a></li>
</ul>
<h2 id="official-packages">Official Packages</h2>
<ul>
<li><a href="Masonite%20Entry" target="_blank">Masonite Entry</a></li>
<li><a href="Masonite%20Billing" target="_blank">Masonite Billing</a></li>
</ul>
<h2 id="creating-your-first-blog">Creating Your First Blog</h2>
<ul>
<li><a href="Introduction">Introduction</a></li>
<li><a href="Part%201%20-%20Creating%20Our%20First%20Route">Part 1 - Creating Our First Route</a></li>
<li><a href="Part%202%20-%20Creating%20Our%20First%20Controller">Part 2 - Creating Our First Controller</a></li>
<li><a href="Part%203%20-%20Designing%20Our%20Blog">Part 3 - Designing Our Blog</a></li>
<li><a href="Part%204%20-%20Migrations">Part 4 - Migrations</a></li>
<li><a href="Part%205%20-%20Models">Part 5 - Models</a></li>
<li><a href="Part%203%20-%20Authentication">Part 3 - Authentication</a></li>
</ul>


  </ul>
</div>


          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title"></h1>
<div class="content ">
  <h1 id="middleware">Middleware</h1>
<h2 id="introduction">Introduction</h2>
<p>Middleware is an extremely important aspect of web applications as it allows you to run important code either before or after every request or even before or after certain routes. In this documentation we&rsquo;ll talk about how middleware works, how to consume middleware and how to create your own middleware. Middleware is only ran when the route is found and a status code of 200 will be returned.</p>
<h2 id="getting-started">Getting Started</h2>
<p>Middleware classes are placed inside the <code>app/http/middleware</code> by convention but can be placed anywhere you like. All middleware are just classes that contain a <code>before</code> method and/or an <code>after</code> method.</p>
<p>There are four types of middleware in total:</p>
<ul>
<li>Middleware ran before every request</li>
<li>Middleware ran after every request</li>
<li>Middleware ran before certain routes</li>
<li>Middleware ran after certain routes</li>
</ul>
<h2 id="creating-middleware">Creating Middleware</h2>
<p>Again, middleware should live inside the <code>app/http/middleware</code> folder and should look something like:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">AuthenticationMiddleware</span><span class="p">:</span>
    <span class="s1">&#39;&#39;&#39; Middleware class &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Request</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">Request</span>

    <span class="k">def</span> <span class="nf">before</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">after</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</code></pre></div><p>Middleware constructors are resolved by the container so simply pass in whatever you like in the parameter list and it will be injected for you.</p>
<p>{% hint style=&quot;success&rdquo; %}
Read more about this in the <a href="Service%20Container">Service Container</a> documentation.
{% endhint %}</p>
<p>If Masonite is running a “before” middleware, that is middleware that should be ran before the request, Masonite will check all middleware and look for a <code>before</code> method and execute that. The same for “after” middleware.</p>
<p>You may exclude either method if you do not wish for that middleware to run before or after.</p>
<p>This is a boilerplate for middleware. It&rsquo;s simply a class with a before and/or after method. Creating a middleware is that simple. Let&rsquo;s create a middleware that checks if the user is authenticated and redirect to the login page if they are not. Because we have access to the request object from the Service Container, we can do something like:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">AuthenticationMiddleware</span><span class="p">:</span>
    <span class="s1">&#39;&#39;&#39; Middleware class which loads the current user into the request &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Request</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">Request</span>

    <span class="k">def</span> <span class="nf">before</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">redirectTo</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">after</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</code></pre></div><p>That&rsquo;s it! Now we just have to make sure our route picks this up. If we wanted this to execute after a request, we could use the exact same logic in the <code>after</code> method instead.</p>
<p>Since we are not utilizing the <code>after</code> method, we may exclude it all together. Masonite will check if the method exists before executing it.</p>
<h2 id="configuration">Configuration</h2>
<p>We have one of two configuration constants we need to work with. These constants both reside in our <code>config/middleware.py</code> file and are <code>HTTP_MIDDLEWARE</code> and <code>ROUTE_MIDDLEWARE</code>.</p>
<p><code>HTTP_MIDDLEWARE</code> is a simple list which should contain an aggregation of your middleware classes. This constant is a list because all middleware will simply run in succession one after another, similar to Django middleware</p>
<p>Middleware is a string to the module location of your middleware class. If your class is located in <code>app/http/middleware/DashboardMiddleware.py</code> then the value we place in our middleware configuration will be a string: <code>app.http.middleware.DashboardMiddleware.DashboardMiddleware</code>. Masonite will locate the class and execute either the <code>before</code> method or the <code>after</code> method.</p>
<p>In our <code>config/middleware.py</code> file this type of middleware may look something like:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">HTTP_MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;app.http.middleware.DashboardMiddleware.DashboardMiddleware&#39;</span>
<span class="p">]</span>
</code></pre></div><p><code>ROUTE_MIDDLEWARE</code> is also simple but instead of a list, it is a dictionary with a custom name as the key and the middleware class as the value. This is so we can specify the middleware based on the key in our routes file.</p>
<p>In our <code>config/middleware.py</code> file this might look something like:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">app.http.middleware.RouteMiddleware</span> <span class="kn">import</span> <span class="n">RouteMiddleware</span>

<span class="n">ROUTE_MIDDLEWARE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="s1">&#39;app.http.middleware.RouteMiddleware.RouteMiddleware&#39;</span>
<span class="p">}</span>
</code></pre></div><h2 id="consuming-middleware">Consuming Middleware</h2>
<p>Using middleware is also simple. If we put our middleware in the <code>HTTP_MIDDLEWARE</code> constant then we don&rsquo;t have to worry about it anymore. It will run on every successful request, that is when a route match is found from our <code>web.py</code> file.</p>
<p>If we are using a route middleware, we&rsquo;ll need to specify which route should execute the middleware. To specify which route we can just append a <code>.middleware()</code> method onto our routes. This will look something like:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">Get</span><span class="p">()</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/dashboard&#39;</span><span class="p">,</span> <span class="s1">&#39;DashboardController@show&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">middleware</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">)</span>
<span class="n">Get</span><span class="p">()</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="s1">&#39;LoginController@show&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">)</span>
</code></pre></div><p>This will execute the auth middleware only when the user visits the <code>/dashboard</code> url and as per our middleware will be redirected to the named route of <code>login</code></p>
<p>Awesome! You’re now an expert at how middleware works with Masonite.</p>

</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.1237ff71925bb8625c97a9af8db4c54525258bedfd7c47493daaff723bea755e.js"></script>
  

  
  
  
    
  


</body>

</html>
