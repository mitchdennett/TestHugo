<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title> - Hugo Whisper Theme</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="/favicon.png">

  
  
  <link rel="stylesheet" href="/css/style.min.aad43d4ecb69a264f2539b89d7f779d5f3cdff22e7585fe5fc3c77272f1c2696.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/">
        <span>Home</span>
      </a>
    </li>
    
    <li class="menu-item-docs">
      <a href="/docs/">
        <span>Docs</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="/"><img alt="Logo" src="/images/logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="/"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/">
        <span>Home</span>
      </a>
    </li>
    
    <li class="menu-item-docs">
      <a href="/docs/">
        <span>Docs</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            



<div class="docs-menu">
  <div class="form-input-group mb-3 pr-3">
    <label>Version</label>
    <div class="custom_select">
      <select onchange="this.options[this.selectedIndex].value && (window.location = this.options[this.selectedIndex].value);">
        
          
            <option value="/docs/">docs</option>
          
        
          
            <option value="/v1.5/" selected>v1.5</option>
          
        
      </select>
    </div>
  </div>
  <ul class="toc">
    
    <h1 id="table-of-contents">Table of contents</h1>
<ul>
<li><a href="README.md">Introduction</a></li>
</ul>
<h2 id="prologue">Prologue</h2>
<ul>
<li><a href="prologue/introduction-and-installaton.md">Introduction and Installaton</a></li>
<li><a href="prologue/contributing-guide.md">Contributing Guide</a></li>
<li><a href="prologue/how-to-contribute.md">How To Contribute</a></li>
<li><a href="prologue/release-cycle.md">Release Cycle</a></li>
</ul>
<h2 id="whats-new">What&rsquo;s New</h2>
<ul>
<li><a href="whats-new/masonite-1.3.md">Masonite 1.3</a></li>
<li><a href="whats-new/masonite-1.4.md">Masonite 1.4</a></li>
<li><a href="whats-new/masonite-1.5.md">Masonite 1.5</a></li>
</ul>
<h2 id="upgrade-guide">Upgrade Guide</h2>
<ul>
<li><a href="upgrade-guide/masonite-1.3-to-1.4.md">Masonite 1.3 to 1.4</a></li>
<li><a href="upgrade-guide/masonite-1.4-to-1.5.md">Masonite 1.4 to 1.5</a></li>
</ul>
<h2 id="the-basics">The Basics</h2>
<ul>
<li><a href="the-basics/routing.md">Routing</a></li>
<li><a href="the-basics/controllers.md">Controllers</a></li>
<li><a href="the-basics/views.md">Views</a></li>
<li><a href="the-basics/requests.md">Requests</a></li>
<li><a href="the-basics/static-files.md">Static Files</a></li>
<li><a href="the-basics/helper-functions.md">Helper Functions</a></li>
</ul>
<h2 id="the-craft-command">The Craft Command</h2>
<ul>
<li><a href="the-craft-command/introduction.md">Introduction</a></li>
<li><a href="the-craft-command/creating-commands.md">Creating Commands</a></li>
<li><a href="the-craft-command/authentication-system.md">Authentication System</a></li>
</ul>
<h2 id="architectural-concepts">Architectural Concepts</h2>
<ul>
<li><a href="architectural-concepts/request-lifecycle.md">Request Lifecycle</a></li>
<li><a href="architectural-concepts/service-providers.md">Service Providers</a></li>
<li><a href="architectural-concepts/service-container.md">Service Container</a></li>
</ul>
<h2 id="advanced">Advanced</h2>
<ul>
<li><a href="advanced/middleware.md">Middleware</a></li>
<li><a href="advanced/validation.md">Validation</a></li>
<li><a href="advanced/creating-packages.md">Creating Packages</a></li>
<li><a href="advanced/extending-classes.md">Extending Classes</a></li>
<li><a href="advanced/creating-a-mail-driver.md">Creating a Mail Driver</a></li>
<li><a href="advanced/sessions.md">Sessions</a></li>
</ul>
<h2 id="useful-features">Useful Features</h2>
<ul>
<li><a href="useful-features/template-caching.md">Template Caching</a></li>
<li><a href="useful-features/mail.md">Mail</a></li>
<li><a href="useful-features/uploading.md">Uploading</a></li>
<li><a href="useful-features/view-composers-and-sharing.md">View Composers and Sharing</a></li>
<li><a href="useful-features/caching.md">Caching</a></li>
<li><a href="useful-features/broadcasting.md">Broadcasting</a></li>
<li><a href="useful-features/queues-and-jobs.md">Queues and Jobs</a></li>
<li><a href="useful-features/compiling-assets.md">Compiling Assets</a></li>
</ul>
<h2 id="security">Security</h2>
<ul>
<li><a href="security/authentication.md">Authentication</a></li>
<li><a href="security/encryption.md">Encryption</a></li>
<li><a href="security/csrf-protection.md">CSRF Protection</a></li>
</ul>
<h2 id="orator-orm">Orator ORM</h2>
<ul>
<li><a href="https://orator-orm.com/docs/0.9/basic_usage.html">Basic Usage</a></li>
<li><a href="https://orator-orm.com/docs/0.9/query_builder.html">Query Builder</a></li>
<li><a href="https://orator-orm.com/docs/0.9/orm.html">ORM</a></li>
<li><a href="https://orator-orm.com/docs/0.9/pagination.html">Pagination</a></li>
<li><a href="https://orator-orm.com/docs/0.9/schema_builder.html">Schema Builder</a></li>
<li><a href="orator-orm/database-migrations.md">Database Migrations</a></li>
<li><a href="https://orator-orm.com/docs/0.9/collections.html">Collections</a></li>
</ul>
<h2 id="managers-and-drivers">Managers and Drivers</h2>
<ul>
<li><a href="managers-and-drivers/about-managers.md">About Managers</a></li>
<li><a href="managers-and-drivers/about-drivers.md">About Drivers</a></li>
<li><a href="managers-and-drivers/contracts.md">Contracts</a></li>
</ul>
<h2 id="official-packages">Official Packages</h2>
<ul>
<li><a href="https://masoniteframework.gitbooks.io/masonite-entry/content/">Masonite Entry</a></li>
<li><a href="http://billing.masoniteproject.com">Masonite Billing</a></li>
</ul>
<h2 id="creating-your-first-blog">Creating Your First Blog</h2>
<ul>
<li><a href="creating-your-first-blog/introduction.md">Introduction</a></li>
<li><a href="creating-your-first-blog/part-1-creating-our-first-route.md">Part 1 - Creating Our First Route</a></li>
<li><a href="creating-your-first-blog/part-2-creating-our-first-controller.md">Part 2 - Creating Our First Controller</a></li>
<li><a href="creating-your-first-blog/part-3-designing-our-blog.md">Part 3 - Designing Our Blog</a></li>
<li><a href="creating-your-first-blog/part-4-migrations.md">Part 4 - Migrations</a></li>
<li><a href="creating-your-first-blog/part-5-models.md">Part 5 - Models</a></li>
<li><a href="creating-your-first-blog/part-3-authentication.md">Part 3 - Authentication</a></li>
</ul>
    
  </ul>
</div>


          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title"></h1>
<div class="content ">
  <h1 id="database-migrations">Database Migrations</h1>
<h2 id="introduction">Introduction</h2>
<p>Database migrations in Masonite is very different than other Python frameworks. Other Python frameworks create migrations based on a model which historically uses Data Mapper type ORM&rsquo;s. Because Masonite uses an Active Record ORM by default, Migrations are completely separated from models. This is great as it allows a seamless switch of ORM&rsquo;s without interfering with migrations. In addition to creating this separation of migrations and models, it makes managing the relationship between models and tables extremely basic with very little magic which leads to faster debugging as well as fewer migration issues.</p>
<p>In this documentation, we&rsquo;ll talk about how to make migrations with Masonite.</p>
<h2 id="getting-started">Getting Started</h2>
<p>Because models and migrations are separated, we never have to touch our model in order to make alterations to our database tables. In order to make a migration we can run a craft command:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">$ craft migration name_of_migration_here --table dashboard
</code></pre></div><p>This command will create a migration for an existing table. A migration on an existing table will migrate into the database in a certain way so it&rsquo;s important to specify the <code>--table</code> flag in the command.</p>
<p>In order to create a migration file for a new table that doesn&rsquo;t yet exist (but will after the migration) you can instead use the <code>--create</code> flag like so:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">$ craft migration name_of_migration_here --create dashboard
</code></pre></div><p>This will create a migration that will create a table, as well as migrate the columns you specify.</p>
<h3 id="migrating-columns">Migrating Columns</h3>
<p>Inside the migration file you will see an <code>up()</code> method and a <code>down()</code> method. We are only interested in the <code>up()</code> method. This method specifies what to do when the migration file is migrated. The <code>down()</code> method is what is executed when the migration is rolled back. Lets walk through creating a blog migration.</p>
<p>We can use <div>
    <a href="Orators%20Schema%20Builder" target="_blank">Orators Schema Builder</a>
</div> in order to build our migration file. First lets run a migration craft command to create a blog table:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">$ craft migration create_blogs_table --create blogs
</code></pre></div><p>This will create a migration file located in <code>databases/migrations</code> . Lets open this file and add some columns.</p>
<p>After we open it we should see something an up() method that looks like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;
</span><span class="s2">        Run the migrations.
</span><span class="s2">        &#34;&#34;&#34;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;blogs&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">timestamps</span><span class="p">()</span>
</code></pre></div><p>Inside our with statement we can start adding columns.</p>
<p>Lets go ahead and add some columns that can be used for a blog table.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;
</span><span class="s2">        Run the migrations.
</span><span class="s2">        &#34;&#34;&#34;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;blogs&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">integer</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">integer</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unsigned</span><span class="p">()</span>
            <span class="n">table</span><span class="o">.</span><span class="n">foreign</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">references</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">timestamps</span><span class="p">()</span>
</code></pre></div><p>Ok let&rsquo;s go ahead and break down what we just created.</p>
<p>Notice that we are using a context processor which is our schema builder. All we have to worry about is whats inside it. Notice that we have a <code>table</code> object that has a few methods that are related to columns. Most of these columns are pretty obvious and you can read about different <div>
    <a href="Orator%20Schema%20Columns" target="_blank">Orator Schema Columns</a>
</div> you can use. We&rsquo;ll mention the foreign key here though.</p>
<h3 id="foreign-keys">Foreign Keys</h3>
<p>So adding columns is really straight forward and Orator has some great documentation on their website. In order to add a foreign key, we&rsquo;ll need an unsigned integer column which we specified above called:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">table</span><span class="o">.</span><span class="n">integer</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unsigned</span><span class="p">()</span>
</code></pre></div><p>This will set up our column index to be ready for a foreign key. We can easily specify a foreign key by then typing</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">table.foreign(&#39;user_id&#39;).references(&#39;id&#39;).on(&#39;users&#39;)
</code></pre></div><p>What this does is sets a foreign key on the <code>user_id</code> column which references the <code>id</code> column on the <code>users</code> table. That&rsquo;s it! It&rsquo;s that easy and expressive to set up a foreign key.</p>
<p>Check the <div>
    <a href="Orator%20documentation" target="_blank">Orator documentation</a>
</div> for more information on creating a migration file.</p>
<h3 id="changing-columns">Changing Columns</h3>
<p>There are two types of columns that we will need to change over the course of developing our application. Changing columns is extremely simple. If you&rsquo;re using MySQL 5.6.6 and below, see the caveat below.</p>
<p>To change a column, we can just use the <code>.change()</code> method on it. Since we need to create a new migration to do this, we can do something like:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="err">$</span> <span class="n">craft</span> <span class="n">migration</span> <span class="n">change_default_status</span> <span class="o">--</span><span class="n">table</span> <span class="n">dashboard</span>
</code></pre></div><p>and then simply create a new migration but use the <code>.change()</code> method to let Masonite you want to change an existing column instead of adding a new one:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">table</span><span class="o">.</span><span class="n">integer</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">nullable</span><span class="p">()</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">change</span><span class="p">()</span>
</code></pre></div><p>When we run <code>craft migrate</code> it will change the column instead of adding a new one.</p>
<h3 id="changing-foreign-keys-prior-to-mysql-566">Changing Foreign Keys Prior to MySQL 5.6.6</h3>
<p>Because of the constraints that foreign keys put on columns prior to MySQL 5.6.6, it&rsquo;s not as straight forward as appending a <code>.change()</code> to the foreign key column. We must first:</p>
<ul>
<li>drop the foreign key relationship</li>
<li>change the column</li>
<li>recreate the foreign key</li>
</ul>
<p>We can do this simply like so:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">table</span><span class="o">.</span><span class="n">drop_foreign</span><span class="p">(</span><span class="s1">&#39;posts_user_id_foreign&#39;</span><span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">rename_column</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;author_id&#39;</span><span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">foreign</span><span class="p">(</span><span class="s1">&#39;author_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">references</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
</code></pre></div>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.1237ff71925bb8625c97a9af8db4c54525258bedfd7c47493daaff723bea755e.js"></script>
  

  
  
  
    
  


</body>

</html>
